AWSTemplateFormatVersion: 2010-09-09
Description: >
  This Cloudformation template builds the necessary IAM policies for creating data repository tasks for FSx. (AWS SID: SO9634)
Resources:
  DataRepoTaskIamPolicy:
    Type: "AWS::IAM::ManagedPolicy"
    Properties:
      PolicyDocument:
        Version: "2012-10-17"
        Statement:
          - Sid: "DataRepoTaskAdmin"
            Effect: Allow
            Action:
              - "fsx:CreateDataRepositoryTask"
              - "fsx:CancelDataRepositoryTask"
            Resource:
              - !Sub "arn:aws:fsx:${AWS::Region}:${AWS::AccountId}:file-system/${FsxId}"
              - !Sub "arn:aws:fsx:${AWS::Region}:${AWS::AccountId}:task/*"
          - Sid: "DataRepoTaskRead"
            Effect: Allow
            Action:
              - "fsx:DescribeDataRepositoryTasks"
            Resource:
              - "arn:aws:fsx:${AWS::Region}:${AWS::AccountId}:*"
